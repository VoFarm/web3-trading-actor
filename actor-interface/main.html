<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Node</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        .scrollable {
            overflow: auto;
        }
    </style>
</head>
<body>

<div>
    <h3>Status</h3>
    <h4 id="listening"></h4>
    <h4 id="counter"></h4>
    <h4 id="priority"></h4>
</div>

<div>
    <h3>Iterations</h3>
    <div id="iterations"></div>
</div>

<script>
    $.get("/listening", (listening) => {
        $("#listening").text(`Application is ${listening != 'undefined' ? '' : 'not'} listening`)
    })

    $.get("/priority", (priority) => {
        $("#priority").text(`Priority: ${priority}`)
    })

    $.get("/log", (listening) => {
        $("#console").empty()
        $("#console").append(listening.map((message) => $("<p>").text(message)))
    })

    $.get("/count", async (count) => {
        $("#counter").text(`Iteration Counter: ${Number(count) + 1}`)
        $("#iterations").empty()
        count = Number(count)
        for (let i = count; i >= ((count - 25) < 0 ? 0 : (count - 25)); i--) {
            await $.get(`/iteration?id=${i}`, (response) => {
                $("#iterations").append($("<div>").css("background", response.success ? "#00800036" : response.inProgress ? "rgba(104,104,104,0.11)" : "#ff00001c").append(
                    $("<hr>"),
                    $("<h3>").text(`Iteration ${i + 1}`),
                    $("<p>").text(`TX Price: ${response.txPrice}`),
                    $("<p>").text(`TX Trade: ${response.txTrade}`),
                    $("<p>").text(`Traded: ${response.traded}`),
                    $("<p>").text(`Date: ${response.startDate}`),
                    $("<p>").text(`Performance: ${response.seconds}s`),
                    $("<h4>").text(`Messages:`),
                    $("<div>").append(response.messages.map((message) => $("<p>").text(message)))
                ));
            })
        }
    })
</script>

</body>
</html>